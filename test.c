 
 /*
  * 
  *
  * gcc test.c -lusb-1.0 -o test

./test 128 128 180 13 29 45 77 125 141 21 127 23 39 55 133 149 148 12 28 44 60 76 92 108 124 140 20 36 52 111 143 85 101 117 148 11 27 43 59 75 91 107 123 139 19 35 51 22 129 145 69 132 10 26 42 58 74 90 106 122 138 18 34 50 126 38 63 79 95 65 81 97 132 9 25 41 57 73 89 105 121 137 17 33 49 15 47 78 94 110 68 84 100 116 8 24 40 56 72 88 104 120 136 16 32 48 14 30 46 62


  * */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <libusb-1.0/libusb.h>

#define VENDOR  0x0951
#define PRODUCT 0x16dc


int claim_interfaces(libusb_device *device, libusb_device_handle *handle) {
    int i = 0, res = 0;
    struct libusb_config_descriptor *config = NULL;

    res = libusb_get_config_descriptor(device, 0, &config);
    if(res != 0) {
        goto cleanup;
    }

    for(i = 0; i < config->bNumInterfaces; ++i) {
        res = libusb_claim_interface(handle, i);
        if(res != LIBUSB_SUCCESS) {
            for(i; i >= 0; --i) {
                libusb_release_interface(handle, i);
            }

            printf("[%d] Failed claiming interface.", res);
            break;
        }
    }

cleanup:
    libusb_free_config_descriptor(config);
    return res;
}

int release_interfaces(libusb_device *device, libusb_device_handle *handle) {
    int i = 0, res = 0;
    struct libusb_config_descriptor *config = NULL;

    res = libusb_get_config_descriptor(device, 0, &config);
    if(res != 0) {
        goto cleanup;
    }

    for(i = 0; i < config->bNumInterfaces; ++i) {
        libusb_release_interface(handle, i);
    }

cleanup:
    libusb_free_config_descriptor(config);
    return res;
}


int find_device(int vendor, int product, libusb_device **output, libusb_device_handle **handle) {
    libusb_device **list;
    libusb_device *device = NULL;
    struct libusb_device_descriptor desc;

    int status = 0, res = 0;
    ssize_t i = 0;
    ssize_t cnt = libusb_get_device_list(NULL, &list);

    *output = NULL;
    *handle = NULL;

    if(cnt < 0) {
        fprintf(stderr, "No USB devices discovered.\n");
        status = 1;
        goto cleanup;
    }

    for(i = 0; i < cnt; ++i) {
        device = list[i];
        res = libusb_get_device_descriptor(device, &desc);

        if(res != 0) {
            fprintf(stderr, "[%d] Error getting device descriptor.\n", res);
            continue;
        }

        if(desc.idVendor == vendor && desc.idProduct == product) {
            *output = device;
            break;
        }
    }

    if(*output != NULL) {
        res = libusb_open(device, handle);
        if(res == LIBUSB_SUCCESS) {
            status = 0;
        }else{
            status = 2;
            fprintf(stderr, "[%d] Failed opening USB device.\n", res);
        }
    } else {
        status = 3;
    }

cleanup:
    libusb_free_device_list(list, 1);
    
    return status;
}

unsigned char keys[255];
char nk =0;

int initcol(libusb_device_handle *handle,
            unsigned r,unsigned g,unsigned b)
{
    unsigned i,len,v;
    char data[512],data2[512];
/*    char keys[]= {
        8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,
        30,32,33,34,35,36,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,55,
        56,57,58,59,60,62,63,65,68,69,72,73,74,75,76,77,78,79,81,84,85,88,
        89,90,91,92,94,95,97,100,101,104,105,106,107,108,110,111,116,117,
        120,121,122,123,124,125,126,127,129,132,133,136,137,138,139,140,
        141,142,143,145,148,149 };
*/
    printf ("L=%i\n",sizeof(keys));
    memset(data,0,264);
    printf ("M=%i\n",sizeof(keys));
    data[0]=0x07;
    data[1]=0x06;
    data[2]=0x02;
    data[3]=0x01;

    for (i=0;i<nk;i++) data[keys[i]]=r;
    printf ("N=%i\n",sizeof(keys));
    v=libusb_control_transfer(handle,
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE,
                              LIBUSB_REQUEST_SET_CONFIGURATION,
                              0x307,2,data,264,10000);
    
    v=libusb_interrupt_transfer(handle,0x83,data2,300,&len,10000);

    data[3]=0x02;
    for (i=0;i<nk;i++) data[keys[i]]=g;
    v=libusb_control_transfer(handle,
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE,
                              LIBUSB_REQUEST_SET_CONFIGURATION,
                              0x307,2,data,264,10000);
    
    v=libusb_interrupt_transfer(handle,0x83,data2,300,&len,10000);

    data[3]=0x03;
    for (i=0;i<nk;i++) data[keys[i]]=b;
    v=libusb_control_transfer(handle,
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE,
                              LIBUSB_REQUEST_SET_CONFIGURATION,
                              0x307,2,data,264,10000);
    
    v=libusb_interrupt_transfer(handle,0x83,data2,300,&len,10000);
    
}

int main(int argc, char *argv[]) {
    libusb_device *device = NULL;
    libusb_device_handle *handle = NULL;
    int status = 0;
    char data[512];
    int v,i,len;
    unsigned r,g,b;
    
    unsigned xlen=264;

    if (argc<4) return 0;
    r=atoi(argv[1]);
    g=atoi(argv[2]);
    b=atoi(argv[3]);
    
    printf ("RGB= %d %d %d\n",r,g,b);

    for (i=4;i<argc;i++) keys[i-4]=atoi(argv[i]);
    nk=argc-4;
    
    char INIT0[] = {
      0x07,0x17,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
    
    //0x09,0x00,0x00,0x17,0x00,0x00,0x00,0x00,0x00

    char INIT1[] = {
      0x07,0x81,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
    
    char INITREAD[] = {
      0x09,0x00,0x00,0x81,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

    /*
    char READDATA[] = {
      0x07,0x81,0x04,0x00,0x00,0x00,0x04,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

      URB CONTROL IN
    requesttype = a1 
        brequest = 1
        value=x0307
        index=2
        lenght = 264

    */
    char INIT2[] = {
      0x07,0x01,0x04,0x00,0x00,0x00,0x04,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

    //0x09,0x00,0x00,0x01,0x00,0x04,0x00,0x00,0x00
    
    char INIT6[] = {
      0x07,0x06,0x02,0x04,0x00,0x00,0x00,0x00,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,
      0x00,0x00,0xFE,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,
      0x00,0x00,0xFE,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

    //0x09,0x00,0x00,0x06,0x00,0x00,0x00,0x00,0x00

    char INIT7[] = {
      0x07,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,
      0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,
      0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x04,0x09,0x04,0x04,0x05,0x05,0x05,0x09,0x03,
      0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

    //0x09,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00

    char INIT8[] = {
      0x07,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,
      0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,
      0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x04,0x09,0x04,0x04,0x05,0x05,0x05,0x09,0x03,
      0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

    //0x09,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00

    char INIT9[] = {
      0x07,0x03,0x04,0x00,0x00,0x00,0x00,0x00,0x29,0x35,0x2B,0x39,0xE1,0xE0,0x45,0x2E,
      0x00,0x5F,0x3A,0x1E,0x14,0x04,0x64,0xE3,0x46,0x89,0xA9,0x60,0x3B,0x1F,0x1A,0x16,
      0x1D,0xE2,0x47,0x2A,0x00,0x61,0x3C,0x20,0x08,0x07,0x1B,0x8B,0x48,0x4C,0xA6,0x00,
      0x3D,0x21,0x15,0x09,0x06,0x2C,0x49,0x4D,0xA7,0x5C,0x3E,0x22,0x17,0x0A,0x19,0x8A,
      0x4A,0x4E,0xA8,0x5D,0x3F,0x23,0x1C,0x0B,0x05,0x88,0x4B,0xE5,0x53,0x5E,0x40,0x24,
      0x18,0x0D,0x11,0xE6,0x30,0xE4,0x54,0x59,0x41,0x25,0x0C,0x0E,0x10,0xAC,0x31,0x52,
      0x55,0x5A,0x42,0x26,0x12,0x0F,0x36,0x65,0x32,0x50,0x56,0x5B,0x43,0x27,0x13,0x33,
      0x37,0xD6,0x28,0x51,0x57,0x62,0x44,0x2D,0x2F,0x34,0x38,0xD7,0x87,0x4F,0x58,0x63,
      0x29,0x35,0x2B,0x39,0xE1,0xE0,0x45,0x2E,0x00,0x5F,0x3A,0x1E,0x14,0x04,0x64,0x01,
      0x46,0x89,0xA9,0x60,0x3B,0x1F,0x1A,0x16,0x1D,0xE2,0x47,0x2A,0x00,0x61,0x3C,0x20,
      0x08,0x07,0x1B,0x8B,0x48,0x4C,0xA6,0x00,0x3D,0x21,0x15,0x09,0x06,0x2C,0x49,0x4D,
      0xA7,0x5C,0x3E,0x22,0x17,0x0A,0x19,0x8A,0x4A,0x4E,0xA8,0x5D,0x3F,0x23,0x1C,0x0B,
      0x05,0x88,0x4B,0xE5,0x53,0x5E,0x40,0x24,0x18,0x0D,0x11,0xE6,0x30,0xE4,0x54,0x59,
      0x41,0x25,0x0C,0x0E,0x10,0xAC,0x31,0x52,0x55,0x5A,0x42,0x26,0x12,0x0F,0x36,0x65,
      0x32,0x50,0x56,0x5B,0x43,0x27,0x13,0x33,0x37,0xD6,0x28,0x51,0x57,0x62,0x44,0x2D,
      0x2F,0x34,0x38,0xD7,0x87,0x4F,0x58,0x63,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

    //0x09,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00

    char INIT10[] = {
      0x07,0x03,0x04,0x01,0x00,0x00,0x00,0x00,0x00,0x35,0x2B,0x39,0xE1,0xE0,0xB9,0x2E,
      0x00,0x5F,0xAD,0x1E,0x14,0x04,0x64,0xE3,0x46,0x89,0xA9,0x60,0xAE,0x1F,0x1A,0x16,
      0x1D,0xE2,0x47,0x2A,0x00,0x61,0xAF,0x20,0x08,0x07,0x1B,0x8B,0x48,0x4C,0xA6,0x00,
      0x3D,0x21,0x15,0x09,0x06,0x2C,0x49,0x4D,0xA7,0x5C,0x3E,0x22,0x17,0x0A,0x19,0x8A,
      0x4A,0x4E,0xA8,0x5D,0xA6,0x23,0x1C,0x0B,0x05,0x88,0x4B,0xE5,0x53,0x5E,0xA7,0x24,
      0x18,0x0D,0x11,0xE6,0x30,0xE4,0x54,0x59,0xA8,0x25,0x0C,0x0E,0x10,0xAC,0x31,0xB6,
      0x55,0x5A,0xA9,0x26,0x12,0x0F,0x36,0x65,0x32,0x50,0x56,0x5B,0xAA,0x27,0x13,0x33,
      0x37,0xD6,0x28,0xB7,0x57,0x62,0xAB,0x2D,0x2F,0x34,0x38,0xD7,0x87,0x4F,0x58,0x63,
      0x00,0x35,0x2B,0x39,0xE1,0xE0,0xB9,0x2E,0x00,0x5F,0xAD,0x1E,0x14,0x04,0x64,0x01,
      0x46,0x89,0xA9,0x60,0xAE,0x1F,0x1A,0x16,0x1D,0xE2,0x47,0x2A,0x00,0x61,0xAF,0x20,
      0x08,0x07,0x1B,0x8B,0x48,0x4C,0xA6,0x00,0x3D,0x21,0x15,0x09,0x06,0x2C,0x49,0x4D,
      0xA7,0x5C,0x3E,0x22,0x17,0x0A,0x19,0x8A,0x4A,0x4E,0xA8,0x5D,0xA6,0x23,0x1C,0x0B,
      0x05,0x88,0x4B,0xE5,0x53,0x5E,0xA7,0x24,0x18,0x0D,0x11,0xE6,0x30,0xE4,0x54,0x59,
      0xA8,0x25,0x0C,0x0E,0x10,0xAC,0x31,0xB6,0x55,0x5A,0xA9,0x26,0x12,0x0F,0x36,0x65,
      0x32,0x50,0x56,0x5B,0xAA,0x27,0x13,0x33,0x37,0xD6,0x28,0xB7,0x57,0x62,0xAB,0x2D,
      0x2F,0x34,0x38,0xD7,0x87,0x4F,0x58,0x63,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
    
    //0x09,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00

    char INIT11[] = {
      0x07,0x17,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
    
    //0x09,0x00,0x00,0x17,0x00,0x00,0x00,0x00,0x00
    
    libusb_init(NULL);
//    libusb_set_debug(NULL, 255);
    
    status = find_device(VENDOR, PRODUCT, &device, &handle);
    if(status != 0) {
        fprintf(stderr, "[%d] Failed to find device.\n", status);
        goto cleanup;
    }
    libusb_set_auto_detach_kernel_driver(handle,1);

    claim_interfaces(device,handle);
    
    //SEND INIT0
    v=libusb_control_transfer(handle, // Dev Handle
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE, // RequestType = 0x21
                              LIBUSB_REQUEST_SET_CONFIGURATION, // Request = 0x09
                              0x307,// Value
                              2, // Index
                              INIT0,// Data
                              xlen,// Length
                              10000);// Timeout

    v=libusb_interrupt_transfer(handle,0x83,data,300,&len,10000);

    printf ("I0:INT IN : LEN=%i\n",len);
    printf ("DATA : "); for (i=0;i<len;i++) printf ("%02X ",data[i]); printf ("\n");
    
    //SEND INIT1
    v=libusb_control_transfer(handle, // Dev Handle
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE, // RequestType = 0x21
                              LIBUSB_REQUEST_SET_CONFIGURATION, // Request = 0x09
                              0x307,// Value
                              2, // Index
                              INIT1,// Data
                              xlen,// Length
                              10000);// Timeout
    
    v=libusb_interrupt_transfer(handle,0x83,data,300,&len,10000);

    printf ("I1:INT IN : LEN=%i\n",len);
    printf ("DATA : "); for (i=0;i<len;i++) printf ("%02X ",data[i]); printf ("\n");
    /*

    //RECEIVE
    v=libusb_control_transfer(handle, // Dev Handle
                              LIBUSB_ENDPOINT_IN |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE, // RequestType = 0xA1
                              LIBUSB_REQUEST_CLEAR_FEATURE, // Request = 0x01
                              0x307,// Value
                              2, // Index
                              INITREAD,// Data
                              xlen,// Length
                              10000);// Timeout

    v=libusb_interrupt_transfer(handle,0x83,data,300,&len,10000);

    printf ("II:INT IN : LEN=%i\n",len);
    printf ("DATA : "); for (i=0;i<len;i++) printf ("%02X ",data[i]); printf ("\n");
    
    */
    //SEND INIT2
    v=libusb_control_transfer(handle, // Dev Handle
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE, // RequestType = 0x21
                              LIBUSB_REQUEST_SET_CONFIGURATION, // Request = 0x09
                              0x307,// Value
                              2, // Index
                              INIT2,// Data
                              xlen,// Length
                              10000);// Timeout
  
    v=libusb_interrupt_transfer(handle,0x83,data,300,&len,10000);

    printf ("I2:INT IN : LEN=%i\n",len);
    printf ("DATA : "); for (i=0;i<len;i++) printf ("%02X ",data[i]); printf ("\n");
    
    initcol(handle,r,g,b);
    
  
    //SEND INIT6
    v=libusb_control_transfer(handle, // Dev Handle
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE, // RequestType = 0x21
                              LIBUSB_REQUEST_SET_CONFIGURATION, // Request = 0x09
                              0x307,// Value
                              2, // Index
                              INIT6,// Data
                              xlen,// Length
                              10000);// Timeout
    
    v=libusb_interrupt_transfer(handle,0x83,data,300,&len,10000);
    printf ("I6:INT IN : LEN=%i\n",len);
    printf ("DATA : "); for (i=0;i<len;i++) printf ("%02X ",data[i]); printf ("\n");

    //SEND INIT7
    v=libusb_control_transfer(handle, // Dev Handle
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE, // RequestType = 0x21
                              LIBUSB_REQUEST_SET_CONFIGURATION, // Request = 0x09
                              0x307,// Value
                              2, // Index
                              INIT7,// Data
                              xlen,// Length
                              10000);// Timeout
    
    v=libusb_interrupt_transfer(handle,0x83,data,300,&len,10000);
    printf ("I7:INT IN : LEN=%i\n",len);
    printf ("DATA : "); for (i=0;i<len;i++) printf ("%02X ",data[i]); printf ("\n");
    
    //SEND INIT8
    v=libusb_control_transfer(handle, // Dev Handle
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE, // RequestType = 0x21
                              LIBUSB_REQUEST_SET_CONFIGURATION, // Request = 0x09
                              0x307,// Value
                              2, // Index
                              INIT8,// Data
                              xlen,// Length
                              10000);// Timeout
    
    v=libusb_interrupt_transfer(handle,0x83,data,300,&len,10000);
    printf ("I8:INT IN : LEN=%i\n",len);
    printf ("DATA : "); for (i=0;i<len;i++) printf ("%02X ",data[i]); printf ("\n");
    
    //SEND INIT9
    v=libusb_control_transfer(handle, // Dev Handle
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE, // RequestType = 0x21
                              LIBUSB_REQUEST_SET_CONFIGURATION, // Request = 0x09
                              0x307,// Value
                              2, // Index
                              INIT9,// Data
                              xlen,// Length
                              10000);// Timeout
    
    v=libusb_interrupt_transfer(handle,0x83,data,300,&len,10000);

    printf ("I9:INT IN : LEN=%i\n",len);
    printf ("DATA : "); for (i=0;i<len;i++) printf ("%02X ",data[i]); printf ("\n");
    
    //SEND INIT10
    v=libusb_control_transfer(handle, // Dev Handle
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE, // RequestType = 0x21
                              LIBUSB_REQUEST_SET_CONFIGURATION, // Request = 0x09
                              0x307,// Value
                              2, // Index
                              INIT10,// Data
                              xlen,// Length
                              10000);// Timeout
    
    v=libusb_interrupt_transfer(handle,0x83,data,300,&len,10000);

    printf ("I10:INT IN : LEN=%i\n",len);
    printf ("DATA : "); for (i=0;i<len;i++) printf ("%02X ",data[i]); printf ("\n");
    
    //SEND INIT11
    v=libusb_control_transfer(handle, // Dev Handle
                              LIBUSB_ENDPOINT_OUT |
                              LIBUSB_REQUEST_TYPE_CLASS |
                              LIBUSB_RECIPIENT_INTERFACE, // RequestType = 0x21
                              LIBUSB_REQUEST_SET_CONFIGURATION, // Request = 0x09
                              0x307,// Value
                              2, // Index
                              INIT11,// Data
                              xlen,// Length
                              10000);// Timeout
    
    v=libusb_interrupt_transfer(handle,0x83,data,300,&len,10000);

    printf ("I11:INT IN : LEN=%i\n",len);
    printf ("DATA : "); for (i=0;i<len;i++) printf ("%02X ",data[i]); printf ("\n");
    
    release_interfaces(device,handle);
    libusb_close(handle);

cleanup:
    libusb_exit(NULL);
    return status;
}

void get_endpoints(libusb_device *device, uint8_t *endpoint_in, uint8_t *endpoint_out) {
    int i = 0, j = 0, k = 0;

    struct libusb_device_descriptor desc; // = NULL;
    struct libusb_config_descriptor *config = NULL;
    const struct libusb_endpoint_descriptor *endpoint = NULL;

    libusb_get_device_descriptor(device, &desc);
    libusb_get_config_descriptor(device, 0, &config);

    for(i = 0; i < config->bNumInterfaces; ++i) {
        for(j = 0; j < config->interface[i].num_altsetting; ++j) {
            for(k = 0; k < config->interface[i].altsetting[j].bNumEndpoints; ++k) {
                endpoint = &config->interface[i].altsetting[j].endpoint[k];

                if ((endpoint->bmAttributes & LIBUSB_TRANSFER_TYPE_MASK) & LIBUSB_TRANSFER_TYPE_INTERRUPT) {
                    if (endpoint->bEndpointAddress & LIBUSB_ENDPOINT_IN) {
                        *endpoint_in = endpoint->bEndpointAddress;
                    } else {
                        *endpoint_out = endpoint->bEndpointAddress;
                    }
                }
            }
        }
    }

    libusb_free_config_descriptor(config);
    return;
}


